<!doctype html>
<html lang="mk" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Countdown — Леар</title>
  <style>
    :root[data-theme="dark"] { --bg:#000; --fg:#fff; --muted:#cfcfcf; --card:#0f0f0f; --border:#2a2a2a; --headline:#fff; --subtle:#b5b5b5; --glow:rgba(255,255,255,.16); --btn-bg:#121212; --btn-fg:#fff; --btn-border:#2a2a2a; --btn-active:#1a1a1a; }
    :root[data-theme="light"] { --bg:#fff; --fg:#000; --muted:#444; --card:#fff; --border:#d9d9d9; --headline:#000; --subtle:#666; --glow:rgba(0,0,0,.12); --btn-bg:#f7f7f7; --btn-fg:#000; --btn-border:#d9d9d9; --btn-active:#efefef; }

    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;min-height:100svh;display:grid;place-items:center;background:var(--bg);color:var(--fg);
         font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}

    .wrap{width:min(1100px,94vw);padding:10px 0 20px}
    .header{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:8px}
    .brand{width:clamp(140px,18vw,240px);height:auto;display:block}
    :root[data-theme="dark"] .brand{filter:invert(1) brightness(1.08)}
    :root[data-theme="light"] .brand{filter:none}

    /* Title: exactly two lines */
    h1{margin:10px 0 44px}
    #mainTitle{display:flex;flex-direction:column;gap:6px;align-items:center;text-align:center;line-height:1.2;color:var(--headline)}
    #mainTitle .row1,#mainTitle .row2{font-weight:400;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    #mainTitle .row1{font-size:52px}
    #mainTitle .row2{font-size:46px}
    #mainTitle .row1 .lead{font-weight:400}
    #mainTitle .row1 .date{font-weight:800}
    #mainTitle .row2 .lear{font-weight:800}

    /* Main counter — boxier cells + bigger digits */
    .timer{display:grid;grid-template-columns:repeat(5,minmax(0,1fr));gap:14px}
    .cell{
      background:linear-gradient(180deg,var(--card),#0b0b0b00);
      border:1px solid var(--border);
      border-radius:16px;
      padding:24px 12px;
      min-height:clamp(110px,18vw,180px);
      display:flex;flex-direction:column;justify-content:center;align-items:center;
      box-shadow:0 6px 24px rgba(0,0,0,.12),inset 0 1px 0 rgba(0,0,0,.02)
    }
    :root[data-theme="dark"] .cell{box-shadow:0 6px 24px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.02)}
    .number{
      font-family:Helvetica,"Helvetica Neue",Arial,sans-serif;
      font-weight:800;
      font-variant-numeric:tabular-nums;
      letter-spacing:.5px;
      font-size:clamp(38px,7vw,76px);
      line-height:1;
      margin-bottom:10px;
      text-shadow:0 0 18px var(--glow);
      color:var(--headline)
    }
    .label{font-size:13px;text-transform:uppercase;letter-spacing:.12em;color:var(--subtle)}

    .divider{border:0;border-top:1px solid var(--border);margin:18px 0 12px}

    @keyframes blink{50%{opacity:.45}} .blink .number,.phase-card.blink{animation:blink .9s steps(2,start) infinite}

    /* Phases layout */
    .phases{margin-top:0;display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
    @media (max-width: 680px){ .phases{grid-template-columns:1fr} }

    .phase-card{position:relative;background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px 12px;box-shadow:0 6px 24px rgba(0,0,0,.08)}
    :root[data-theme="dark"] .phase-card{box-shadow:0 6px 24px rgba(0,0,0,.2)}
    .phase-title{font-weight:700;color:var(--headline);font-size:clamp(15px,2.2vw,18px)}
    .phase-deadline{color:var(--muted);font-size:12px;margin-top:2px}

    /* Phase timer: 4 boxes, wraps two-per-row on narrow phones */
    .phase-timer{
      position:relative;
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
      gap:8px;
      margin-top:10px
    }
    .p-cell{background:transparent;border:1px dashed var(--border);border-radius:10px;padding:12px 10px;min-height:86px}
    .p-number{font-family:Helvetica,"Helvetica Neue",Arial,sans-serif;font-weight:800;font-variant-numeric:tabular-nums;font-size:clamp(20px,5.5vw,30px);
              line-height:1;margin-bottom:6px;color:var(--headline);text-shadow:0 0 12px var(--glow)}
    .p-label{font-size:10px;text-transform:uppercase;letter-spacing:.12em;color:var(--subtle)}

    .done-overlay{position:absolute;inset:0;display:none;align-items:center;justify-content:center;font-weight:900;letter-spacing:.08em;
                  text-transform:uppercase;font-size:clamp(34px,7vw,80px);color:#000;background:rgba(255,255,255,.85);border-radius:12px;pointer-events:none}
    .is-done .done-overlay{display:flex} .is-done .phase-timer{opacity:.15;filter:grayscale(1)}

    .meta{display:flex;justify-content:center;gap:14px;flex-wrap:wrap;margin:12px 0 8px}
    .pill{font-size:12px;padding:6px 10px;border-radius:999px;background:var(--card);border:1px solid var(--border);color:var(--muted)}
    .pill b{color:var(--fg);font-weight:800}
    .status{color:var(--fg)} .status.warn{color:var(--muted)}
    .sub{color:var(--muted);font-size:14px;margin:8px 0 12px;text-align:center}
    .deadline{margin-top:4px;font-size:13px;color:var(--muted);text-align:center}
    .expired{margin-top:10px;font-size:14px;color:var(--fg);font-weight:800;display:none;text-align:center}

    .footer{display:flex;justify-content:center;margin-top:14px}
    .seg{display:inline-flex;border:1px solid var(--btn-border);border-radius:999px;overflow:hidden}
    .seg button{background:var(--btn-bg);color:var(--fg);border:0;padding:8px 12px;font-size:12px;cursor:pointer}
    .seg button+button{border-left:1px solid var(--btn-border)} .seg button[aria-pressed="true"]{background:var(--btn-active);font-weight:700}

    @media (max-width:720px){
      .header{flex-direction:column;align-items:flex-start;gap:10px}
      #mainTitle{align-items:flex-start;text-align:left}
      .timer{grid-template-columns:repeat(3,1fr)}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <img class="brand" alt="Лого" src="https://propertyone.mk/files/prva-firma-1_0.png" />
      <div></div>
    </div>

    <!-- Two-line dynamic title: bold date/time + LEAR -->
    <h1 id="mainTitle" aria-live="polite">
      <div class="row1">
        <span class="lead">Сега е - </span>
        <span class="date" id="titleDate">среда, 24 септември 10:08,</span>
      </div>
      <div class="row2">а крајот на рокот за <span class="lear">ЛЕАР</span> е за:</div>
    </h1>

    <div id="mainTimer" class="timer" role="timer" aria-live="polite">
      <div class="cell"><div class="number" id="weeks">00</div><div class="label">недели</div></div>
      <div class="cell"><div class="number" id="days">00</div><div class="label">дена</div></div>
      <div class="cell"><div class="number" id="hours">00</div><div class="label">часа</div></div>
      <div class="cell"><div class="number" id="minutes">00</div><div class="label">минути</div></div>
      <div class="cell"><div class="number" id="seconds">00</div><div class="label">секунди</div></div>
    </div>

    <hr class="divider" />

    <div class="phases" id="phases"></div>

    <div class="meta">
      <div class="pill">Временска зона: <b id="tzText">—</b></div>
      <div class="pill">Статус: <b class="status" id="statusText">—</b></div>
    </div>
    <div class="sub" id="note">Броиме 10 целосни недели од понеделник, 29 септември 2025 (00:00), до понеделник, 8 декември 2025 (00:00).</div>
    <div id="expired" class="expired">Рокот истече.</div>
    <div class="deadline" id="deadlineText"></div>

    <div class="footer" aria-label="Theme">
      <div class="seg">
        <button id="btnDark"  type="button" aria-pressed="false">Dark</button>
        <button id="btnLight" type="button" aria-pressed="true">Light</button>
      </div>
    </div>
  </div>

  <script>
    // Theme (default: light)
    const htmlEl=document.documentElement, btnDark=document.getElementById('btnDark'), btnLight=document.getElementById('btnLight'), THEME_KEY='countdown_theme_bw';
    function applyTheme(t){ htmlEl.setAttribute('data-theme',t); btnDark.setAttribute('aria-pressed',String(t==='dark')); btnLight.setAttribute('aria-pressed',String(t==='light')); try{localStorage.setItem(THEME_KEY,t);}catch(e){} }
    (function(){let t='light';try{t=localStorage.getItem(THEME_KEY)||t;}catch(e){} applyTheme(t);})(); btnDark.addEventListener('click',()=>applyTheme('dark')); btnLight.addEventListener('click',()=>applyTheme('light'));

    // Time helpers
    function mkDate(y,m,d,hh=0,mm=0,ss=0){return new Date(y,m-1,d,hh,mm,ss)}
    const DAY=86400000, WEEK=7*DAY, HOUR=3600000, MIN=60000, SEC=1000;
    const START_DATE=mkDate(2025,9,29,0,0,0);
    const DEADLINE=new Date(START_DATE); DEADLINE.setDate(DEADLINE.getDate()+70);

    // Phases
    const PHASES=[
      {name:'Фаза 0 — Пример (Завршено)', done:true,  deadline:mkDate(2025,9,29,0,0,0)},
      {name:'Фаза 1 — Демонтажа',          done:false, deadline:mkDate(2025,10,13,0,0,0)},
      {name:'Фаза 2 — Гипс картон',        done:false, deadline:mkDate(2025,10,27,0,0,0)},
      {name:'Фаза 3 — Под/теписон',        done:false, deadline:mkDate(2025,11,17,0,0,0)},
      {name:'Фаза 4 — Стаклени прегради',  done:false, deadline:mkDate(2025,12,8,0,0,0)},
    ];

    // Done via URL or imperative API (?done=1,3)
    const params=new URLSearchParams(location.search);
    if (params.has('done')) { params.get('done').split(',').map(s=>parseInt(s,10)).filter(n=>!isNaN(n)).forEach(i=>{ if(PHASES[i]) PHASES[i].done=true; }); }
    window.setPhaseDone=function(i,val=true){ if (PHASES[i]) { PHASES[i].done=!!val; tick(); } };

    // Elements
    const el={
      titleDate:document.getElementById('titleDate'),
      tzText:document.getElementById('tzText'),
      statusText:document.getElementById('statusText'),
      weeks:document.getElementById('weeks'),
      days:document.getElementById('days'),
      hours:document.getElementById('hours'),
      minutes:document.getElementById('minutes'),
      seconds:document.getElementById('seconds'),
      expired:document.getElementById('expired'),
      deadlineText:document.getElementById('deadlineText'),
      phases:document.getElementById('phases'),
      mainTimer:document.getElementById('mainTimer')
    };

    // Macedonian formatting
    const MK_WEEKDAYS=['недела','понеделник','вторник','среда','четврток','петок','сабота'];
    const MK_MONTHS=['јануари','февруари','март','април','мај','јуни','јули','август','септември','октомври','ноември','декември'];
    function pad2(n){ return String(n).padStart(2,'0'); }
    function nowParts(d){
      return { wd: MK_WEEKDAYS[d.getDay()], day: d.getDate(), m: MK_MONTHS[d.getMonth()], hh: pad2(d.getHours()), mm: pad2(d.getMinutes()) };
    }
    function formatDeadlineMK(d){
      const wd=MK_WEEKDAYS[d.getDay()], day=d.getDate(), month=MK_MONTHS[d.getMonth()], y=d.getFullYear(), hh=pad2(d.getHours()), mm=pad2(d.getMinutes());
      return wd + ', ' + day + ' ' + month + ' ' + y + ' ' + hh + ':' + mm;
    }
    function formatTZ(offsetMin){
      const total = -offsetMin; const sign = total>=0? '+' : '-'; const abs = Math.abs(total);
      return 'GMT' + sign + String(Math.floor(abs/60)).padStart(2,'0') + ':' + String(abs%60).padStart(2,'0');
    }

    // Init texts
    el.tzText.textContent = 'локално (' + formatTZ(new Date().getTimezoneOffset()) + ')';
    el.deadlineText.textContent = 'Краен датум: ' + formatDeadlineMK(DEADLINE);

    // Auto-fit so each row stays on one line (start bigger, shrink if needed)
    function fitRow(row, maxPx, minPx){
      const wrap = document.getElementById('mainTitle');
      let size = maxPx;
      row.style.fontSize = size + 'px';
      const limit = Math.max(0, wrap.clientWidth - 8);
      while (row.scrollWidth > limit && size > minPx){
        size -= 1;
        row.style.fontSize = size + 'px';
      }
    }
    function fitTitle(){
      const row1 = document.querySelector('#mainTitle .row1');
      const row2 = document.querySelector('#mainTitle .row2');
      if(!row1 || !row2) return;
      fitRow(row1, 52, 16);
      fitRow(row2, 46, 14);
    }
    let _lastMinute = '';

    // Render phases
    function renderPhaseCards(){
      const ph=document.getElementById('phases');
      ph.innerHTML=PHASES.map((p,i)=>`
        <div class="phase-card" id="p_card_${i}">
          <div class="phase-title">${p.name}</div>
          <div class="phase-deadline" id="p_deadline_${i}"></div>
          <div class="phase-timer">
            <div class="p-cell"><div class="p-number" id="p_w_${i}">00</div><div class="p-label">недели</div></div>
            <div class="p-cell"><div class="p-number" id="p_d_${i}">00</div><div class="p-label">дена</div></div>
            <div class="p-cell"><div class="p-number" id="p_h_${i}">00</div><div class="p-label">часа</div></div>
            <div class="p-cell"><div class="p-number" id="p_m_${i}">00</div><div class="p-label">минути</div></div>
            <div class="done-overlay" id="p_overlay_${i}">ЗАВРШЕНО</div>
          </div>
        </div>
      `).join('');
      PHASES.forEach((p,i)=>{
        document.getElementById('p_deadline_'+i).textContent='Крај: ' + formatDeadlineMK(p.deadline);
      });
    }

    const URGENT_MS=7*DAY;
    function tick(){
      const now=new Date();
      const parts = nowParts(now);
      el.titleDate.textContent = parts.wd + ', ' + parts.day + ' ' + parts.m + ' ' + parts.hh + ':' + parts.mm + ',';

      if (_lastMinute !== parts.mm){
        _lastMinute = parts.mm;
        fitTitle();
      }

      // Main timer
      el.mainTimer.classList.remove('blink');
      if(now<START_DATE){
        el.statusText.textContent='пред почеток';
        const ms=START_DATE-now;
        renderNumbers(ms,{w:el.weeks,d:el.days,h:el.hours,m:el.minutes,s:el.seconds});
        if(ms<=URGENT_MS) el.mainTimer.classList.add('blink');
        el.expired.style.display='none';
      } else if(now>=START_DATE && now<DEADLINE){
        el.statusText.textContent='во тек';
        const ms=DEADLINE-now;
        renderNumbers(ms,{w:el.weeks,d:el.days,h:el.hours,m:el.minutes,s:el.seconds});
        if(ms<=URGENT_MS) el.mainTimer.classList.add('blink');
        el.expired.style.display='none';
      } else {
        el.statusText.textContent='истечен рок';
        ['weeks','days','hours','minutes','seconds'].forEach(k=>el[k].textContent='00');
        el.expired.style.display='';
      }

      // Phases
      PHASES.forEach((p,i)=>{
        const tw=document.getElementById('p_w_'+i),
              td=document.getElementById('p_d_'+i),
              th=document.getElementById('p_h_'+i),
              tm=document.getElementById('p_m_'+i),
              card=document.getElementById('p_card_'+i);

        const timeDone=(p.deadline - now)<=0;
        const isDone=!!p.done || timeDone;

        card.classList.remove('blink','is-done');
        if(isDone){
          tw.textContent=td.textContent=th.textContent=tm.textContent='00';
          card.classList.add('is-done');
        } else {
          const diff=p.deadline-now;
          renderNumbers4(diff,{w:tw,d:td,h:th,m:tm});
          if(diff<=URGENT_MS) card.classList.add('blink');
        }
      });
    }

    function renderNumbers(ms,t){
      let diff=ms;
      const w=Math.floor(diff/WEEK); diff%=WEEK;
      const d=Math.floor(diff/DAY);  diff%=DAY;
      const h=Math.floor(diff/HOUR); diff%=HOUR;
      const m=Math.floor(diff/MIN);  diff%=MIN;
      const s=Math.floor(diff/SEC);
      t.w.textContent=String(w).padStart(2,'0');
      t.d.textContent=String(d).padStart(2,'0');
      t.h.textContent=String(h).padStart(2,'0');
      t.m.textContent=String(m).padStart(2,'0');
      t.s.textContent=String(s).padStart(2,'0');
    }

    function renderNumbers4(ms,t){
      let diff=ms;
      const w=Math.floor(diff/WEEK); diff%=WEEK;
      const d=Math.floor(diff/DAY);  diff%=DAY;
      const h=Math.floor(diff/HOUR); diff%=HOUR;
      const m=Math.floor(diff/MIN);
      t.w.textContent=String(w).padStart(2,'0');
      t.d.textContent=String(d).padStart(2,'0');
      t.h.textContent=String(h).padStart(2,'0');
      t.m.textContent=String(m).padStart(2,'0');
    }

    renderPhaseCards();
    tick();
    fitTitle();
    setInterval(tick,500);
    let _rto=null;
    window.addEventListener('resize',()=>{ clearTimeout(_rto); _rto=setTimeout(fitTitle, 80); });
  </script>
</body>
</html>
